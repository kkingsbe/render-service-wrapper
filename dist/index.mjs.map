{"version":3,"sources":["../src/healthCheckManager.ts","../src/service.ts"],"sourcesContent":["import * as express from \"express\"\r\nimport { Server } from \"http\";\r\n\r\n/**\r\n * This class is used to create a health check endpoint for microservices running within Render.com\r\n */\r\nexport class HealthCheckManager {\r\n    port: number;\r\n    app: express.Application;\r\n    server: Server | null = null;\r\n\r\n    /**\r\n     * \r\n     * @param port The port to run the healthcheck endpoint on. Usually will be 10000\r\n     * @param endpoint The path to run the healthcheck endpoint on. Usually will be \"/\"\r\n     */\r\n    constructor(port: number, endpoint: string = \"/healthz\") {\r\n        this.port = port;\r\n\r\n        this.app = express();\r\n        this.app.get(endpoint, (req: any, res: any) => {\r\n            res.status(200).send(\"\")\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Starts the healthcheck endpoint\r\n     */\r\n    start() {\r\n        this.server = this.app.listen(this.port)\r\n    }\r\n\r\n    stop() {\r\n        this.server?.close()\r\n    }\r\n}","import { HealthCheckManager } from \"./healthCheckManager\";\r\n\r\nexport interface ServiceConfig {\r\n    healthCheckPort?: number;\r\n    healthCheckEndpoint?: string;\r\n    isCronJob: boolean\r\n}\r\n\r\n/**\r\n * This is an abstract class which is meant to serve as a wrapper for all microservices used.\r\n * It provides some of the basic requried functionality, such as starting the health check manager.\r\n */\r\nexport abstract class Service {\r\n    healthCheckPort: number;\r\n    healthCheckEndpoint: string;\r\n    isCronJob: boolean;\r\n    private healthCheckManager: HealthCheckManager;\r\n\r\n    constructor(config: ServiceConfig) {\r\n        this.healthCheckPort = config.healthCheckPort ?? 10000;\r\n        this.healthCheckEndpoint = config.healthCheckEndpoint ?? \"/\";\r\n        this.isCronJob = config.isCronJob;\r\n\r\n        this.healthCheckManager = new HealthCheckManager(this.healthCheckPort, this.healthCheckEndpoint);\r\n    }\r\n\r\n    // Starts the health check manager and runs the microservice\r\n    async start() {\r\n        this.healthCheckManager.start();\r\n        await this.run()\r\n\r\n        // Terminate after execution if the microservice is a cron job, in order to prevent it from hanging\r\n        if(this.isCronJob) {\r\n            //this.stop()\r\n            this.healthCheckManager.stop()\r\n        }\r\n    }\r\n\r\n    // Microservice code goes here\r\n    abstract run(): Promise<void>\r\n\r\n    // Stops the microservice\r\n    async stop() {\r\n        process.exit();\r\n    }\r\n}"],"mappings":";AAAA,YAAY,aAAa;AAMlB,IAAM,qBAAN,MAAyB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA,SAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOxB,YAAY,MAAc,WAAmB,YAAY;AACrD,SAAK,OAAO;AAEZ,SAAK,MAAM,QAAQ;AACnB,SAAK,IAAI,IAAI,UAAU,CAAC,KAAU,QAAa;AAC3C,UAAI,OAAO,GAAG,EAAE,KAAK,EAAE;AAAA,IAC3B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ;AACJ,SAAK,SAAS,KAAK,IAAI,OAAO,KAAK,IAAI;AAAA,EAC3C;AAAA,EAEA,OAAO;AAhCX;AAiCQ,eAAK,WAAL,mBAAa;AAAA,EACjB;AACJ;;;ACvBO,IAAe,UAAf,MAAuB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACQ;AAAA,EAER,YAAY,QAAuB;AAC/B,SAAK,kBAAkB,OAAO,mBAAmB;AACjD,SAAK,sBAAsB,OAAO,uBAAuB;AACzD,SAAK,YAAY,OAAO;AAExB,SAAK,qBAAqB,IAAI,mBAAmB,KAAK,iBAAiB,KAAK,mBAAmB;AAAA,EACnG;AAAA;AAAA,EAGA,MAAM,QAAQ;AACV,SAAK,mBAAmB,MAAM;AAC9B,UAAM,KAAK,IAAI;AAGf,QAAG,KAAK,WAAW;AAEf,WAAK,mBAAmB,KAAK;AAAA,IACjC;AAAA,EACJ;AAAA;AAAA,EAMA,MAAM,OAAO;AACT,YAAQ,KAAK;AAAA,EACjB;AACJ;","names":[]}